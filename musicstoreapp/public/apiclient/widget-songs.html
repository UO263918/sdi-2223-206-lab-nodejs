<!DOCTYPE html>
<html lang="en">
<head>
  <title>jQuery uoMusic </title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script
          src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<div id="widget-songs" >
  <button class="btn btn-primary" onclick="widgetAddSong()">Nueva Canción</button>
  <button class="btn" onclick="loadSongs()" >Actualizar</button>
  <table class="table table-hover">
    <thead>
    <tr>
      <th>Título</th>
      <th>Género</th>
      <th>Precio</th>
      <th class="col-md-1"></th>
    </tr>
    </thead>
    <tbody id="songsTableBody"></tbody>
  </table>
</div>
<script>
  var selectedSongId;
  var songs;

  function loadSongs() {
    $.ajax({
      url: URLbase + "/songs",
      type: "GET",
      data: {},
      dataType: 'json',
      headers: {"token": token},
      success: function (response) {
        songs = response.songs;
        updateSongsTable(songs);
        },
      error: function (error) {
        $("#main-container").load("widget-login.html");
      }
    });
  }

  function updateSongsTable(songs) {
    $("#songsTableBody").empty(); // Vaciar la tabla
    for (i = 0; i < songs.length; i++) {
      $("#songsTableBody").append(
              "<tr id=" + songs[i]._id + ">" +
              "<td>" + songs[i].title + "</td>" +
              "<td>" + songs[i].kind + "</td>" +
              "<td>" + songs[i].price + "</td>" +
              "<td>" +
              "<a onclick=songDetail('" + songs[i]._id + "')>Detalles</a><br>" +
              "<a onclick=songDelete('" + songs[i]._id + "')>Eliminar</a>" +
              "</td>" +
              "</tr>");
      // Mucho cuidado con las comillas del eliminarCancion
      // la id tiene que ir entre comillas ' '
    }
  }

  setInterval(function() {
    loadSongs();
  }, 5000);

  function songDelete(_id) {
    $.ajax({ url: URLbase + "/songs/" + _id,
      type: "DELETE",
      data: {},
      dataType: 'json',
      headers: {"token": token},
      success: function (response) {
        console.log("Canción eliminada: " + _id);
        $("#" + _id).remove();// eliminar el <tr> de la canción
      },
      error: function (error) {
        $("#main-container").load("widget-login.html");
      }
    });
  }

  function songDetail(_id) {
    selectedSongId = _id;
    $("#main-container").load("widget-detail.html");
  }

  function widgetAddSong() {
    $( "#main-container" ).load( "widget-add.html");
  }
</script>
</body>
</html>